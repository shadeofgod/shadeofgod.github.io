<!DOCTYPE html>
<html lang="pt-br">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Closure for dummies(translated)</title>
    <meta name="description" content="">

    <!-- Google Authorship Markup -->
    <link rel="author" href="https://plus.google.com/?rel=author">

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@">
    <meta name="twitter:title" content="Closure for dummies(translated)">
    <meta name="twitter:description" content="">
    
    <meta property="twitter:image:src" content="http://localhost:4000">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="http://localhost:4000/Closure/">
    <meta property="og:title" content="Closure for dummies(translated)">
    
    <meta property="og:image" content="http://localhost:4000">
    
    <meta property="og:description" content="">
    <meta property="og:site_name" content="ShadeofGod">

    <!-- Social: Google+ / Schema.org  -->
    <meta itemprop="name" content="Closure for dummies(translated)"/>
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://localhost:4000/assets/img/blog-image.png"/>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon" />
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/favicons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-touch-icon-152x152.png" />
    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="ShadeofGod Blog">
    <meta name="msapplication-TileColor" content="#5d4d7a">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#5d4d7a">

    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="http://localhost:4000/Closure/">
    <link rel="alternate" type="application/rss+xml" title="ShadeofGod" href="http://localhost:4000/feed.xml" />
</head>

    <body>
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-email" viewBox="0 0 1024 1024"><path class="path1" d="M950.857 859.429v-438.857q-18.286 20.571-39.429 37.714-153.143 117.714-243.429 193.143-29.143 24.571-47.429 38.286t-49.429 27.714-58.571 14h-1.143q-27.429 0-58.571-14t-49.429-27.714-47.429-38.286q-90.286-75.429-243.429-193.143-21.143-17.143-39.429-37.714v438.857q0 7.429 5.429 12.857t12.857 5.429h841.143q7.429 0 12.857-5.429t5.429-12.857zM950.857 258.857v-14t-0.286-7.429-1.714-7.143-3.143-5.143-5.143-4.286-8-1.429h-841.143q-7.429 0-12.857 5.429t-5.429 12.857q0 96 84 162.286 110.286 86.857 229.143 181.143 3.429 2.857 20 16.857t26.286 21.429 25.429 18 28.857 15.714 24.571 5.143h1.143q11.429 0 24.571-5.143t28.857-15.714 25.429-18 26.286-21.429 20-16.857q118.857-94.286 229.143-181.143 30.857-24.571 57.429-66t26.571-75.143zM1024 237.714v621.714q0 37.714-26.857 64.571t-64.571 26.857h-841.143q-37.714 0-64.571-26.857t-26.857-64.571v-621.714q0-37.714 26.857-64.571t64.571-26.857h841.143q37.714 0 64.571 26.857t26.857 64.571z"/></symbol><symbol id="icon-close" viewBox="0 0 805 1024"><path class="path1" d="M741.714 755.429q0 22.857-16 38.857l-77.714 77.714q-16 16-38.857 16t-38.857-16l-168-168-168 168q-16 16-38.857 16t-38.857-16l-77.714-77.714q-16-16-16-38.857t16-38.857l168-168-168-168q-16-16-16-38.857t16-38.857l77.714-77.714q16-16 38.857-16t38.857 16l168 168 168-168q16-16 38.857-16t38.857 16l77.714 77.714q16 16 16 38.857t-16 38.857l-168 168 168 168q16 16 16 38.857z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-rss" viewBox="0 0 805 1024"><path class="path1" d="M219.429 768q0 45.714-32 77.714t-77.714 32-77.714-32-32-77.714 32-77.714 77.714-32 77.714 32 32 77.714zM512 838.286q1.143 16-9.714 27.429-10.286 12-26.857 12h-77.143q-14.286 0-24.571-9.429t-11.429-23.714q-12.571-130.857-105.429-223.714t-223.714-105.429q-14.286-1.143-23.714-11.429t-9.429-24.571v-77.143q0-16.571 12-26.857 9.714-9.714 24.571-9.714h2.857q91.429 7.429 174.857 46t148 103.714q65.143 64.571 103.714 148t46 174.857zM804.571 839.429q1.143 15.429-10.286 26.857-10.286 11.429-26.286 11.429h-81.714q-14.857 0-25.429-10t-11.143-24.286q-6.857-122.857-57.714-233.429t-132.286-192-192-132.286-233.429-58.286q-14.286-0.571-24.286-11.143t-10-24.857v-81.714q0-16 11.429-26.286 10.286-10.286 25.143-10.286h1.714q149.714 7.429 286.571 68.571t243.143 168q106.857 106.286 168 243.143t68.571 286.571z"/></symbol><symbol id="icon-google-plus" viewBox="0 0 951 1024"><path class="path1" d="M420 454.857q0 20.571 18.286 40.286t44.286 38.857 51.714 42 44 59.429 18.286 81.143q0 51.429-27.429 98.857-41.143 69.714-120.571 102.571t-170.286 32.857q-75.429 0-140.857-23.714t-98-78.571q-21.143-34.286-21.143-74.857 0-46.286 25.429-85.714t67.714-65.714q74.857-46.857 230.857-57.143-18.286-24-27.143-42.286t-8.857-41.714q0-20.571 12-48.571-26.286 2.286-38.857 2.286-84.571 0-142.571-55.143t-58-139.714q0-46.857 20.571-90.857t56.571-74.857q44-37.714 104.286-56t124.286-18.286h238.857l-78.857 50.286h-74.857q42.286 36 64 76t21.714 91.429q0 41.143-14 74t-33.714 53.143-39.714 37.143-34 35.143-14 37.714zM336.571 400q21.714 0 44.571-9.429t37.714-24.857q30.286-32.571 30.286-90.857 0-33.143-9.714-71.429t-27.714-74-48.286-59.143-66.857-23.429q-24 0-47.143 11.143t-37.429 30q-26.857 33.714-26.857 91.429 0 26.286 5.714 55.714t18 58.857 29.714 52.857 42.857 38.286 55.143 14.857zM337.714 898.857q33.143 0 63.714-7.429t56.571-22.286 41.714-41.714 15.714-62.286q0-14.286-4-28t-8.286-24-15.429-23.714-16.857-20-22-19.714-20.857-16.571-23.714-17.143-20.857-14.857q-9.143-1.143-27.429-1.143-30.286 0-60 4t-61.429 14.286-55.429 26.286-39.143 42.571-15.429 60.286q0 40 20 70.571t52.286 47.429 68 25.143 72.857 8.286zM800.571 398.286h121.714v61.714h-121.714v125.143h-60v-125.143h-121.143v-61.714h121.143v-124h60v124z"/></symbol><symbol id="icon-github-alt" viewBox="0 0 951 1024"><path class="path1" d="M365.714 694.857q0 22.857-7.143 46.857t-24.571 43.429-41.429 19.429-41.429-19.429-24.571-43.429-7.143-46.857 7.143-46.857 24.571-43.429 41.429-19.429 41.429 19.429 24.571 43.429 7.143 46.857zM731.429 694.857q0 22.857-7.143 46.857t-24.571 43.429-41.429 19.429-41.429-19.429-24.571-43.429-7.143-46.857 7.143-46.857 24.571-43.429 41.429-19.429 41.429 19.429 24.571 43.429 7.143 46.857zM822.857 694.857q0-68.571-39.429-116.571t-106.857-48q-23.429 0-111.429 12-40.571 6.286-89.714 6.286t-89.714-6.286q-86.857-12-111.429-12-67.429 0-106.857 48t-39.429 116.571q0 50.286 18.286 87.714t46.286 58.857 69.714 34.286 80 16.857 85.143 4h96q46.857 0 85.143-4t80-16.857 69.714-34.286 46.286-58.857 18.286-87.714zM950.857 594.286q0 118.286-34.857 189.143-21.714 44-60.286 76t-80.571 49.143-97.143 27.143-98 12.571-95.429 2.571q-44.571 0-81.143-1.714t-84.286-7.143-87.143-17.143-78.286-29.429-69.143-46.286-49.143-65.714q-35.429-70.286-35.429-189.143 0-135.429 77.714-226.286-15.429-46.857-15.429-97.143 0-66.286 29.143-124.571 61.714 0 108.571 22.571t108 70.571q84-20 176.571-20 84.571 0 160 18.286 60-46.857 106.857-69.143t108-22.286q29.143 58.286 29.143 124.571 0 49.714-15.429 96 77.714 91.429 77.714 227.429z"/></symbol><symbol id="icon-right-arrow"><path d="M21.205,5.007c-0.429-0.444-1.143-0.444-1.587,0c-0.429,0.429-0.429,1.143,0,1.571l8.047,8.047H1.111  C0.492,14.626,0,15.118,0,15.737c0,0.619,0.492,1.127,1.111,1.127h26.554l-8.047,8.032c-0.429,0.444-0.429,1.159,0,1.587  c0.444,0.444,1.159,0.444,1.587,0l9.952-9.952c0.444-0.429,0.444-1.143,0-1.571L21.205,5.007z" fill="#489472"/></symbol></defs></svg>

        <header class="header-post" role="banner">
   	<!-- <p>λ</p> -->
    <div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search...">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>

<div id="fade" class="overlay"></div>
<a id="slide" class="slideButton fade">
    <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    <svg id="close" class="icon-menu"><use xlink:href="#icon-close"></use></svg>
</a>
<aside id="sidebar">
  <div id="topmenu">
  
    <ul>
      <li><span>1</span></li>
      <li><span> /Closure/</span></li>
      <li><span>⌘  blogspace  </span></li>
      <li><span>  Menu  </span></li>
    </ul>
    <ul>
      <li><span>utf-8</span></li>
      <li><span>web</span></li>
      <li><span>.html</span></li>
    </ul>
  </div>
  <nav id="navigation">
    <!-- <h2>MENU</h2> -->
    <ul>
      
      
      
        <li><span class="counter-menu">1</span><svg viewBox="0 0 50 50" class="icon-arrow-menu"><use xlink:href="#icon-right-arrow"></use></svg><a href="http://localhost:4000/"> home</a></li>
      

         
      
      
        <li><span class="counter-menu">2</span><svg viewBox="0 0 50 50" class="icon-arrow-menu"><use xlink:href="#icon-right-arrow"></use></svg><a href="http://localhost:4000/posts"> my posts</a></li>
      

         
      
      
        <li><span class="counter-menu">3</span><svg viewBox="0 0 50 50" class="icon-arrow-menu"><use xlink:href="#icon-right-arrow"></use></svg><a href="http://localhost:4000/series"> series</a></li>
      

         
      
      
        <li><span class="counter-menu">4</span><svg viewBox="0 0 50 50" class="icon-arrow-menu"><use xlink:href="#icon-right-arrow"></use></svg><a href="http://localhost:4000/tags"> tags</a></li>
      

         
      
      
        <li><span class="counter-menu">5</span><svg viewBox="0 0 50 50" class="icon-arrow-menu"><use xlink:href="#icon-right-arrow"></use></svg><a href="http://localhost:4000/about"> about me</a></li>
      

         
      
    </ul>
    <ul>
      <li><span class="counter-menu">g</span><svg viewBox="0 0 50 50" class="icon-arrow-menu"><use xlink:href="#icon-right-arrow"></use></svg><a target="_blank" href="http://github.com/shadeofgod" class="search">github</a></li>
      <li><span class="counter-menu">s</span><svg viewBox="0 0 50 50" class="icon-arrow-menu"><use xlink:href="#icon-right-arrow"></use></svg><a class="search">search</a></li>
      <!-- <li><span class="counter-menu">t</span><svg viewBox="0 0 50 50" class="icon-arrow-menu"><use xlink:href="#icon-right-arrow"></use></svg><a target="_blank" href="http://twitter.com/">twitter</a></li> -->
    </ul>
  </nav>
</aside>
<a id="search" class="dosearch">
    <svg class="icon-menu icon-search"><use xlink:href="#icon-search"></use></svg>
</a>

</header>

        <div class="tree-posts">
    <h3>*Posts*</h3>
    
    <article role="article" class="post-item" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
        <div class="content">
            <a href="/Closure/">
                <h2 class="post-title" itemprop="name">Closure for dummies(translated).md</h2>
            </a>
        </div>
    </article>
    
    <article role="article" class="post-item" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
        <div class="content">
            <a href="/%E4%BA%BA%E7%94%9F%E3%81%AF%E3%83%9E%E3%83%A9%E3%82%BD%E3%83%B3%E3%81%A7%E3%81%99/">
                <h2 class="post-title" itemprop="name">人生はマラソンです.md</h2>
            </a>
        </div>
    </article>
    
    <article role="article" class="post-item" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
        <div class="content">
            <a href="/space/">
                <h2 class="post-title" itemprop="name">Github is awesome.md</h2>
            </a>
        </div>
    </article>
    
</div>
        <section class="post" itemscope itemtype="http://schema.org/BlogPosting">
            
                <div class="time">
                    <time itemprop="datePublished" datetime="2016-10-16 06:22:31 +0800">16 Oct 2016</time>
                </div>
            
            <h1 class="post-title" itemprop="name">Closure for dummies(translated)</h1>

            <article role="article" id="scroll" class="post-content" itemprop="articleBody">
                <h2 id="javascript-closures-for-dummies">JavaScript Closures for Dummies</h2>

<p>originally posted on <a href="http://stackoverflow.com/questions/111102/how-do-javascript-closures-work">stackoverflow</a> by Morris.</p>

<p>这是一篇在stackoverflow上关于Javascript闭包的解释，因为大部分中文或者英文官方资料都写的都非常晦涩难懂，在这里尽量用中文化的习惯翻译并解释，不同于英文的部分加入的是自己的理解，欢迎对错误的地方进行指正！希望本文让自己能有更深刻的理解，也可以帮到初学者。以下并附上英文部分的原文。</p>

<p>This page explains closures so that a programmer can understand them — using working JavaScript code. It is not for gurus or functional programmers.</p>

<p>以下通过Javascript代码为大家简单解释一下闭包的概念，大牛可以选择跳过。</p>

<p>Closures are <em>not hard</em> to understand once the core concept is grokked. However, they are impossible to understand by reading any academic papers or academically oriented information about them!</p>

<p>只要核心的概念理解了以后，闭包其实就很好懂了，但是在学术性质比较浓的专业文档中读起来却会感觉非常难以理解。</p>

<p>This article is intended for programmers with some programming experience in a mainstream language, and who can read the following JavaScript function:</p>

<p>此文主要是为一些有基础编程经验的，了解一门主流编程语言，并且可以看懂以下简单Javascript代码的程序员所写的：</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">sayHello</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="s1">'Hello '</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span> <span class="p">}</span>
    <span class="nx">say</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="an-example-of-a-closure-">An Example of a Closure 一个闭包的例子</h2>

<p>Two one sentence summaries:</p>

<ul>
  <li>a closure is one way of supporting <a href="https://en.wikipedia.org/wiki/First-class_function">first-class functions</a>; it is an expression that can reference variables within its scope (when it was first declared), assigned to a variable, passed as an argument to a function, or returned as a function result. Or</li>
  <li>a closure is a stack frame which is allocated when a function starts its execution, and <em>not freed</em> after the function returns (as if a ‘stack frame’ were allocated on the heap rather than the stack!).</li>
</ul>

<p>两句话总结：</p>

<ul>
  <li>闭包是一种支持头等函数的方式；是一种可以在变量初次声明时的作用域内引用变量，赋值给另外一个变量，作为参数传递给一个函数或者作为一个函数的返回值的表达方式。</li>
  <li>闭包是当一个函数开始执行时分配到堆栈中的一系列数据，并且在函数返回时并不会被释放。</li>
</ul>

<p>（注：对以上的翻译并不满意，建议阅读英文资料，但看不懂也没有关系，可以继续看下面的例子。）</p>

<p>The following code returns a reference to a function:</p>

<p>下面的代码返回了一个函数引用值：</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">sayHello2</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="s1">'Hello '</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span> <span class="c1">// Local variable</span>
    <span class="kd">var</span> <span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nx">say</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">say2</span> <span class="o">=</span> <span class="nx">sayHello2</span><span class="p">(</span><span class="s1">'Bob'</span><span class="p">);</span>
<span class="nx">say2</span><span class="p">();</span> <span class="c1">// logs "Hello Bob"</span>
</code></pre>
</div>

<p>Most JavaScript programmers will understand how a reference to a function is returned to a variable (<code class="highlighter-rouge">say2</code>) in the above code. If you don’t, then you need to before you can learn closures. A C programmer would think of the function as returning a pointer to a function, and that the variables<code class="highlighter-rouge">say</code> and <code class="highlighter-rouge">say2</code> were each a pointer to a function.</p>

<p>大部分JavaScript开发者都会明白上面的代码中函数返回给变量<code class="highlighter-rouge">say2</code>的是函数的引用值，即<code class="highlighter-rouge">say2</code>=<code class="highlighter-rouge">say</code>,而不是<code class="highlighter-rouge">say()</code>,没有带括号意味着函数并没有被调用，而C语言的开发者会理解为函数返回的是一个函数的指针（即指向的某一个函数，而非立刻调用某函数），而<code class="highlighter-rouge">say</code>和<code class="highlighter-rouge">say2</code>两者都是同一个函数的指针。</p>

<p>There is a critical difference between a C pointer to a function and a JavaScript reference to a function. In JavaScript, you can think of a function reference variable as having both a pointer to a function <em>as well</em> as a hidden pointer to a closure.</p>

<p>而C语言中的函数指针和JavaScript中的函数引用值有一个很关键的区别。你可以理解为在JS中，一个函数的引用变量既包含了一个函数的指针，也包含了一个指向闭包的隐藏指针。</p>

<p>The above code has a closure because the anonymous function <code class="highlighter-rouge">function() { console.log(text); }</code> is declared <em>inside</em> another function, <code class="highlighter-rouge">sayHello2()</code> in this example. In JavaScript, if you use the <code class="highlighter-rouge">function</code> keyword inside another function, you are creating a closure.</p>

<p>上面的代码中含有闭包是因为 <code class="highlighter-rouge">function() { console.log(text); }</code> 这个匿名函数在一个函数内部被声明，并且在外部被使用，在JavaScript如果你在一个函数内部使用了<code class="highlighter-rouge">function</code> 关键字来定义一个新的函数，你其实就是创建了一个闭包。</p>

<p>In C and most other common languages, <em>after</em> a function returns, all the local variables are no longer accessible because the stack-frame is destroyed.</p>

<p>在c语言和大部分主流语言中，在一个函数结束返回了值以后，所有的内部局部变量都再也无法访问，因为堆栈中的数据已经被释放摧毁了。</p>

<p>In JavaScript, if you declare a function within another function, then the local variables can remain accessible after returning from the function you called. This is demonstrated above, because we call the function <code class="highlighter-rouge">say2()</code> after we have returned from <code class="highlighter-rouge">sayHello2()</code>. Notice that the code that we call references the variable <code class="highlighter-rouge">text</code>, which was a <em>local variable</em> of the function <code class="highlighter-rouge">sayHello2()</code>.</p>

<p>在js中，如果你在一个函数内部定义了一个新的函数，那么内部的局部变量在通过你返回的这个新的函数被调用的时候还是可以被访问的。上面的例子里面，因为我们从<code class="highlighter-rouge">sayHello2()</code>返回了在它内部定义的函数给<code class="highlighter-rouge">say2</code>，这样在调用<code class="highlighter-rouge">say2()</code>的时候，实际上变量<code class="highlighter-rouge">text</code>作为 <code class="highlighter-rouge">sayHello2()</code>的内部的局部变量还是可以被我们访问到。</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span> <span class="p">}</span> <span class="c1">// Output of say2.toString();</span>
</code></pre>
</div>

<p>Looking at the output of <code class="highlighter-rouge">say2.toString()</code>, we can see that the code refers to the variable <code class="highlighter-rouge">text</code>. The anonymous function can reference <code class="highlighter-rouge">text</code> which holds the value <code class="highlighter-rouge">'Hello Bob'</code> because the local variables of <code class="highlighter-rouge">sayHello2()</code> are kept in a closure.</p>

<p>你可以看到把变量<code class="highlighter-rouge">say2</code>转换为字符串的结果，其实的代码就需要使用到变量<code class="highlighter-rouge">text</code>。这个匿名函数中的变量<code class="highlighter-rouge">text</code>其实就保存了<code class="highlighter-rouge">Hello Bob</code>这样一个值，因为这个函数 <code class="highlighter-rouge">sayHello2()</code>的内部的局部变量处于一个闭包之中。</p>

<p>The magic is that in JavaScript a function reference also has a secret reference to the closure it was created in — similar to how delegates are a method pointer plus a secret reference to an object.</p>

<p>神奇的地方在于，js中一个函数的引用值也包含了闭包被创建的时候的秘密引用值，就好像其他编程语言中的委托，是一个方法的指针，也是一个对象的秘密引用值。</p>

<h2 id="more-examples-">More examples 更多例子</h2>

<p>For some reason, closures seem really hard to understand when you read about them, but when you see some examples you can click to how they work (it took me a while). I recommend working through the examples carefully until you understand how they work. If you start using closures without fully understanding how they work, you would soon create some very weird bugs!</p>

<p>闭包通常在你读这些解释文字的时候会感到非常难以理解，但是结合具体例子的话就好多了。强烈建议你详细阅读下面的例子并且搞清楚他们到底是如何工作的。如果你没有彻底搞清楚闭包的机制，在使用的时候非常容易造成一些奇怪的bug！</p>

<h3 id="example-3">Example 3</h3>

<p>This example shows that the local variables are not copied — they are kept by reference. It is kind of like keeping a stack-frame in memory when the outer function exits!</p>

<p>下面的例子展示了，局部变量并不是被复制的，而是直接引用的，就好像在函数执行完成后数据仍然被保存在堆栈中。</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">say667</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Local variable that ends up within closure</span>
    <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span> <span class="p">}</span>
    <span class="nx">num</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">say</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">sayNumber</span> <span class="o">=</span> <span class="nx">say667</span><span class="p">();</span>
<span class="nx">sayNumber</span><span class="p">();</span> <span class="c1">// logs 43</span>
</code></pre>
</div>

<h3 id="example-4">Example 4</h3>

<p>All three global functions have a common reference to the <em>same</em> closure because they are all declared within a single call to <code class="highlighter-rouge">setupSomeGlobals()</code>.</p>

<p>所有的三个全局函数都有一个指向同一个闭包的相同引用值，因为他们都是通过 <code class="highlighter-rouge">setupSomeGlobals()</code>这同一个函数被声明的。</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">gLogNumber</span><span class="p">,</span> <span class="nx">gIncreaseNumber</span><span class="p">,</span> <span class="nx">gSetNumber</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">setupSomeGlobals</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Local variable that ends up within closure</span>
    <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="c1">// Store some references to functions as global variables</span>
    <span class="nx">gLogNumber</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span> <span class="p">}</span>
    <span class="nx">gIncreaseNumber</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">num</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    <span class="nx">gSetNumber</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">num</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">setupSomeGlobals</span><span class="p">();</span>
<span class="nx">gIncreaseNumber</span><span class="p">();</span>
<span class="nx">gLogNumber</span><span class="p">();</span> <span class="c1">// 43</span>
<span class="nx">gSetNumber</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nx">gLogNumber</span><span class="p">();</span> <span class="c1">// 5</span>

<span class="kd">var</span> <span class="nx">oldLog</span> <span class="o">=</span> <span class="nx">gLogNumber</span><span class="p">;</span>

<span class="nx">setupSomeGlobals</span><span class="p">();</span>
<span class="nx">gLogNumber</span><span class="p">();</span> <span class="c1">// 42</span>

<span class="nx">oldLog</span><span class="p">()</span> <span class="c1">// 5</span>
</code></pre>
</div>

<p>The three functions have shared access to the same closure — the local variables of <code class="highlighter-rouge">setupSomeGlobals()</code> when the three functions were defined.</p>

<p>当这三个函数被定义时都共享了同一个闭包 - 即函数 <code class="highlighter-rouge">setupSomeGlobals()</code> 内部的局部变量。</p>

<p>Note that in the above example, if you call <code class="highlighter-rouge">setupSomeGlobals()</code> again, then a new closure (stack-frame!) is created. The old <code class="highlighter-rouge">gLogNumber</code>, <code class="highlighter-rouge">gIncreaseNumber</code>, <code class="highlighter-rouge">gSetNumber</code> variables are overwritten with <em>new</em> functions that have the new closure. (In JavaScript, whenever you declare a function inside another function, the inside function(s) is/are recreated again <em>each</em> time the outside function is called.)</p>

<p>注意到上面的例子里，如果你再次调用 <code class="highlighter-rouge">setupSomeGlobals()</code>，一个新的闭包又形成了，旧的<code class="highlighter-rouge">gLogNumber</code>, <code class="highlighter-rouge">gIncreaseNumber</code>, <code class="highlighter-rouge">gSetNumber</code> 这些变量都被新的值覆盖了。（在js中，当你在一个函数内部声明了另外一个函数，那么当外部这个函数被调用的时候，内部的函数总会被重新创建。）</p>

<h3 id="example-5">Example 5</h3>

<p>This one is a real gotcha for many people, so you need to understand it. Be very careful if you are defining a function within a loop: the local variables from the closure do not act as you might first think.</p>

<p>这一个例子让很多人茅塞顿开，所以你一定要理解它！要注意当你在一个循环中定义一个函数的时候，闭包里的局部变量并不会像你想的那样运作。</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">buildList</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="s1">'item'</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">])}</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">testList</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fnlist</span> <span class="o">=</span> <span class="nx">buildList</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span>
    <span class="c1">// Using j only to help prevent confusion -- could use i.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">fnlist</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fnlist</span><span class="p">[</span><span class="nx">j</span><span class="p">]();</span>
    <span class="p">}</span>
<span class="p">}</span>

 <span class="nx">testList</span><span class="p">()</span> <span class="c1">//logs "item2 undefined" 3 times</span>
</code></pre>
</div>

<p>The line <code class="highlighter-rouge">result.push( function() {console.log(item + ' ' + list[i])}</code> adds a reference to an anonymous function three times to the result array. If you are not so familiar with anonymous functions think of it like:</p>

<p> <code class="highlighter-rouge">result.push( function() {console.log(item + ' ' + list[i])}</code> 这一行把里面这个匿名函数的引用值三次添加到了结果的数组里。如果你对匿名函数不是很熟悉，可以这么想：</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">pointer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">])};</span>
<span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pointer</span><span class="p">);</span>
</code></pre>
</div>

<p>Note that when you run the example, <code class="highlighter-rouge">"item2 undefined"</code> is alerted three times! This is because just like previous examples, there is only one closure for the local variables for <code class="highlighter-rouge">buildList</code>. When the anonymous functions are called on the line <code class="highlighter-rouge">fnlist[j]()</code>; they all use the same single closure, and they use the current value for <code class="highlighter-rouge">i</code> and <code class="highlighter-rouge">item</code> within that one closure (where <code class="highlighter-rouge">i</code> has a value of <code class="highlighter-rouge">3</code> because the loop had completed, and <code class="highlighter-rouge">item</code> has a value of <code class="highlighter-rouge">'item2'</code>). Note we are indexing from 0 hence <code class="highlighter-rouge">item</code> has a value of <code class="highlighter-rouge">item2</code>. And the i++ will increment <code class="highlighter-rouge">i</code> to the value <code class="highlighter-rouge">3</code>.</p>

<p>注意当你运行这个例子的时候，出来的结果是打印三次 <code class="highlighter-rouge">"item2 undefined"</code> 。这是因为同之前的例子一样，对于 <code class="highlighter-rouge">buildList</code>中的局部变量，他们都处于唯一的闭包中。当匿名函数在 <code class="highlighter-rouge">fnlist[j]()</code>这里被调用的时候，他们都是用同一个唯一的闭包，使用同一个目前的<code class="highlighter-rouge">i</code>和<code class="highlighter-rouge">item</code>的值，而循环已经结束，此时的<code class="highlighter-rouge">i</code>的值为3，而<code class="highlighter-rouge">item</code>的值为<code class="highlighter-rouge">item2</code>。注意，<code class="highlighter-rouge">i</code>从0开始计算，循环结束的时候通过<code class="highlighter-rouge">i++</code>变成了3，而没有满足循环条件再次进入循环，因此<code class="highlighter-rouge">item</code>的值还是为<code class="highlighter-rouge">item2</code>。</p>

<h3 id="example-6">Example 6</h3>

<p>This example shows that the closure contains any local variables that were declared inside the outer function before it exited. Note that the variable <code class="highlighter-rouge">alice</code> is actually declared after the anonymous function. The anonymous function is declared first; and when that function is called it can access the <code class="highlighter-rouge">alice</code> variable because <code class="highlighter-rouge">alice</code> is in the same scope (JavaScript does <a href="http://stackoverflow.com/a/3725763/1269037">variable hoisting</a>). Also <code class="highlighter-rouge">sayAlice()()</code> just directly calls the function reference returned from <code class="highlighter-rouge">sayAlice()</code>— it is exactly the same as what was done previously, but without the temporary variable.</p>

<p>这个例子展示了闭包包含了在外部函数结束前声明的所有局部变量。注意，变量<code class="highlighter-rouge">alice</code>实际上是在匿名函数之后声明的，匿名函数首先被定义，当这个函数被调用时它依然可以访问到<code class="highlighter-rouge">alice</code>这个变量，因为<code class="highlighter-rouge">alice</code>在同样的作用域内。同样的，<code class="highlighter-rouge">sayAlice()()</code>直接通过<code class="highlighter-rouge">sayAlice()</code>返回的函数引用值调用了指向的函数，而省略了我们之前先把函数引用值保存在一个临时的变量这一步骤。</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">sayAlice</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">alice</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// Local variable that ends up within closure</span>
    <span class="kd">var</span> <span class="nx">alice</span> <span class="o">=</span> <span class="s1">'Hello Alice'</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">say</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">sayAlice</span><span class="p">()();</span><span class="c1">// logs "Hello Alice"</span>
</code></pre>
</div>

<p>Tricky: note also that the <code class="highlighter-rouge">say</code> variable is also inside the closure, and could be accessed by any other function that might be declared within <code class="highlighter-rouge">sayAlice()</code>, or it could be accessed recursively within the inside function.</p>

<p>注意，变量<code class="highlighter-rouge">say</code>同样也在闭包之中，并且可以被其他可能在<code class="highlighter-rouge">sayAlice()</code>内部的函数所访问，意味着可以在内部通过递归函数来访问。</p>

<h3 id="example-7">Example 7</h3>

<p>This final example shows that each call creates a separate closure for the local variables. There is <em>not</em> a single closure per function declaration. There is a closure for <em>each call</em> to a function.</p>

<p>最后一个例子展示了每次调用都为局部变量创造了一个分开的闭包。并不是每次函数声明都有一个单独的闭包，而是函数调用的时候！</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">newClosure</span><span class="p">(</span><span class="nx">someNum</span><span class="p">,</span> <span class="nx">someRef</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Local variables that end up within closure</span>
    <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="nx">someNum</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">anArray</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">someRef</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">num</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="nx">anArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'num: '</span> <span class="o">+</span> <span class="nx">num</span> <span class="o">+</span>
            <span class="s1">'\nanArray '</span> <span class="o">+</span> <span class="nx">anArray</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span>
            <span class="s1">'\nref.someVar '</span> <span class="o">+</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">someVar</span><span class="p">);</span>
      <span class="p">}</span>
<span class="p">}</span>
<span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span><span class="na">someVar</span><span class="p">:</span> <span class="mi">4</span><span class="p">};</span>
<span class="nx">fn1</span> <span class="o">=</span> <span class="nx">newClosure</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
<span class="nx">fn2</span> <span class="o">=</span> <span class="nx">newClosure</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
<span class="nx">fn1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// num: 5; anArray: 1,2,3,5; ref.someVar: 4;</span>
<span class="nx">fn2</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// num: 6; anArray: 1,2,3,6; ref.someVar: 4;</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">someVar</span><span class="o">++</span><span class="p">;</span>
<span class="nx">fn1</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// num: 7; anArray: 1,2,3,5,7; ref.someVar: 5;</span>
<span class="nx">fn2</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// num: 8; anArray: 1,2,3,6,8; ref.someVar: 5;</span>
</code></pre>
</div>

<h2 id="summary-">Summary 总结</h2>

<p>If everything seems completely unclear then the best thing to do is to play with the examples. Reading an explanation is much harder than understanding examples. My explanations of closures and stack-frames, etc. are not technically correct — they are gross simplifications intended to help understanding. Once the basic idea is grokked, you can pick up the details later.</p>

<p>如果完全不懂的话最好从具体的例子入手，只是阅读一些解释的文字通常很难理解。我的关于闭包和堆栈的解释实际上并非绝对准确，他们只是为了简单的帮助你理解，在最基础的概念弄懂以后，你可以多查阅学习一些具体的细节。</p>

<h2 id="final-points-">Final points: 最后几点：</h2>

<ul>
  <li>
    <p>Whenever you use <code class="highlighter-rouge">function</code> inside another function, a closure is used.</p>

    <p>当你在一个函数内部定义一个函数的时候，你就使用了闭包。</p>
  </li>
  <li>
    <p>Whenever you use <code class="highlighter-rouge">eval()</code> inside a function, a closure is used. The text you <code class="highlighter-rouge">eval</code> can reference local variables of the function, and within <code class="highlighter-rouge">eval</code> you can even create new local variables by using <code class="highlighter-rouge">eval('var foo = …')</code></p>

    <p>不管你什么时候在函数内部使用<code class="highlighter-rouge">eval()</code>函数，你就使用了闭包。你可以<code class="highlighter-rouge">eval</code>来引用函数的局部变量，也可以通过在<code class="highlighter-rouge">eval</code>的参数内来创建新的局部变量。</p>
  </li>
  <li>
    <p>When you use <code class="highlighter-rouge">new Function(…)</code> (the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function">Function constructor</a>) inside a function, it does not create a closure. (The new function cannot reference the local variables of the outer function.)</p>

    <p>当你在函数内部使用构造函数的时候，并不会创建闭包。</p>
  </li>
  <li>
    <p>A closure in JavaScript is like keeping a copy of all the local variables, just as they were when a function exited.</p>

    <p>js中的闭包就好像在函数执行完毕后依然保留着所有局部变量。</p>
  </li>
  <li>
    <p>It is probably best to think that a closure is always created just on entry to a function, and the local variables are added to that closure.</p>

    <p>最好总是在函数刚进入的时候就考虑闭包的建立并且把所有局部变量加入到闭包中。</p>
  </li>
  <li>
    <p>A new set of local variables is kept every time a function with a closure is called (given that the function contains a function declaration inside it, and a reference to that inside function is either returned or an external reference is kept for it in some way).</p>

    <p>在每次函数被调用的时候，闭包中的局部变量的值都会重新调整。（前提是这个函数内部包含了函数声明，并且这个内部函数的引用值作为返回值或者保存到了外部的引用。）</p>
  </li>
  <li>
    <p>Two functions might look like they have the same source text, but have completely different behaviour because of their ‘hidden’ closure. I don’t think JavaScript code can actually find out if a function reference has a closure or not.</p>

    <p>两个函数可能看上去他们有同样的来源，但是由于隐藏的闭包所以有着完全不同的行为。</p>
  </li>
  <li>
    <p>If you are trying to do any dynamic source code modifications (for example: <code class="highlighter-rouge">myFunction = Function(myFunction.toString().replace(/Hello/,'Hola'));</code>), it won’t work if <code class="highlighter-rouge">myFunction</code> is a closure (of course, you would never even think of doing source code string substitution at runtime, but…).</p>
  </li>
  <li>
    <p>It is possible to get function declarations within function declarations within functions — and you can get closures at more than one level.</p>

    <p>在函数内部的函数声明中再次声明新的函数也是可能的，而且你可以超过一个层级的闭包。</p>
  </li>
  <li>
    <p>I think normally a closure is the term for both the function along with the variables that are captured. Note that I do not use that definition in this article!</p>
  </li>
  <li>
    <p>I suspect that closures in JavaScript differ from those normally found in functional languages.</p>
  </li>
</ul>

<h2 id="links">Links</h2>

<p>另附阮一峰老师关于闭包的解释，写的非常好！<a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html">学习Javascript闭包（Closure）</a>。</p>

            </article>

            <!-- <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;&quot;%20http://localhost:4000/Closure/%20via%20&#64;&hashtags=Closure,"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook"href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/Closure/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
    <a aria-label="Share on Google Plus" href="https://plus.google.com/share?url=http://localhost:4000/Closure/"
    onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
        <svg class="icon icon-google-plus"><use xlink:href="#icon-google-plus"></use></svg>
    </a>
</section> -->
            <section class="comments">
    <h3>Comments</h3>
    <!-- <div id="disqus_thread"></div> -->
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="Closure for dummies(translated)" data-title='' data-url="/Closure/"></div>
    <!-- 多说评论框 end -->
</section>
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"shadeofgod"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
<!-- 多说公共JS代码 end -->

<!-- <script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = '';
        var disqus_title = '';
        var disqus_url = '/Closure/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script> -->

            <footer>
	<!-- <p>Made with <span id="heart">💚</span></p> -->
</footer>

            <script src="/assets/js/main.js"></script>
        </section>
    </body>
</html>
