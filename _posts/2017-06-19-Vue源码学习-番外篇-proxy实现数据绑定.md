---
layout: post
title: "Vue源码学习番外篇-proxy实现数据绑定"
image: ''
date: 2017-06-15 10:15:27
tags:
- Vue 
description: '尝试利用ES6的Proxy特性实现数据绑定'
---

proxy在中文里往往翻译成代理的意思，在JS中可以在对象间架设一层中间层，访问一个对象时需要先通过这一层：

```javascript
var obj = new Proxy({}, {
  get: function (target, key, receiver) {
    console.log(`getting ${key}!`);
    return Reflect.get(target, key, receiver);
  },
  set: function (target, key, value, receiver) {
    console.log(`setting ${key}!`);
    return Reflect.set(target, key, value, receiver);
  }
});
```

可以看到和我们之前使用`Object.defineProperty`来实现数据绑定很相似。

Proxy是ES6中的新特性，它非常强大，但这里我们不详细解释，更多关于Proxy的内容可以参考[这里](http://es6.ruanyifeng.com/?search=...&x=3&y=10#docs/proxy)。

首先我们来试一下简单的数据类型：

```javascript
const person = {
      name: 'jack',
      age: 25,
      info: {
        prof: 'teacher',
        city: 'beijng'
      }
    }

const observer = data => new Proxy(data, {
  get: function(target, prop) {
    console.log(`getting the ${prop}`)
    return target[prop]
  },
  set: function(target, prop, value) {
    console.log(`setting the ${prop} to ${value}`)
    target[prop] = value
  }
})

let proxy = observer(person)
```

效果如图：

![1.gif]({{site.url}}/assets/images/2017-06-19-Vue源码学习-番外篇-proxy实现数据绑定/1.gif)

可以看到这个效果和我们之前所使用的`Object.defineProperty`所达成的是一样的。那么对于属性的值为数组和对象的复杂类型呢？